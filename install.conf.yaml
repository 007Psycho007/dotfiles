- defaults:
    link:
      create: true
      relink: true

# safer than nuking all of ~, but adjust to taste
- clean: ['~/.config']

- create:
    - ~/.config
    - ~/.local/bin
    - ~/.config/systemd/user

- link:
    # fish
    ~/.ssh/config: config/ssh/config
    ~/.config/fish/config.fish: config/fish/config.fish
    # kitty
    ~/.config/kitty/kitty.conf: config/kitty/kitty.conf
    # rofi
    ~/.config/rofi/config.rasi: config/rofi/config.rasi
    ~/.config/rofi/onedark.rasi: config/rofi/onedark.rasi
    # hyprland + hyprlock + hyprpaper
    ~/.config/hypr/hyprland.conf: config/hypr/hyprland.conf
    ~/.config/hypr/hyprlock.conf: config/hypr/hyprlock.conf
    ~/.config/hypr/hyprpaper.conf: config/hypr/hyprpaper.conf
    # starship
    ~/.config/starship.toml: config/starship/starship.toml
    # extras from xdg.configFile.*
    ~/.config/qtile: config/qtile
    ~/.config/waybar: config/waybar
    ~/.config/files: config/files
    ~/.config/nvim: config/nvim
    ~/.config/scripts: config/scripts

# ---- Repo packages via omnipkg ----
- omnipkg:
  - install:
    - pipewire
    - hyprland
    - hyprpolkitagent
    - vim
    - wget
    - nvim
    - fish
    - firefox
    - rofi-wayland
    - swaync
    - git
    - jq
    - cmake
    - make
    - gcc
    - libtool
    - bluez
    - bitwarden
    - ripgrep
    - waybar
    - hyprpaper
    - kanshi
    - thunderbird
    - discord
    - starship
    - base-devel
    - xdg-desktop-portal
    - xdg-desktop-portal-gtk
    - wl-clipboard
    - grim
    - slurp
    - xdg-utils
    - hyprlock
    - hyprshot
    - wlogout
    - ttf-sourcecodepro-nerd
    - seatd

# ---- AUR packages via yay ----
- yay:
  - xdg-desktop-portal-hyprland
  - brave-bin

# ---- Post steps ----
- shell:
    - description: "Enable lingering for user services"
      command: |
        if command -v loginctl >/dev/null; then
          loginctl enable-linger "$USER" || true
        fi

    - description: "Refresh font cache"
      command: |
        [[ -d "$HOME/.local/share/fonts" ]] && fc-cache -f || true

    - description: "Refresh font cache"
      command: |
        sudo pacman -Sy --noconfirm rofi-wayland nvim

    - description: "Register fish in /etc/shells"
      command: |
        fish_path="$(command -v fish)"
        if [ -z "$fish_path" ]; then
          echo "fish not found on PATH" >&2
          exit 1
        fi
        if ! sudo grep -qx "$fish_path" /etc/shells; then
          echo "$fish_path" | sudo tee -a /etc/shells >/dev/null
        fi

    - description: "Change default shell to fish for current user"
      command: |
        fish_path="$(command -v fish)"
        current_shell="$(getent passwd "$USER" | cut -d: -f7)"
        if [ "$current_shell" != "$fish_path" ]; then
          sudo chsh -s "$fish_path" "$USER"
          echo "Default shell changed to: $fish_path"
        else
          echo "Default shell already set to fish"
        fi
    - description: "Add hy3 to Hyprland"
      command: |
        hyprpm enable
        hyprpm add https://github.com/outfoxxed/hy3
        hyprpm enable hy3
